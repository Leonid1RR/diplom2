generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Store {
  id          Int          @id @default(autoincrement())
  name        String
  address     String
  description String
  photo       String?
  password    String // üîë –ø–∞—Ä–æ–ª—å –º–∞–≥–∞–∑–∏–Ω–∞

  warehouse   Warehouse?
  supplies    Supply[]     @relation("StoreSupplies") // –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏
  reviews     Review[]     @relation("StoreReviews") // –æ—Ç–∑—ã–≤—ã –æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –º–∞–≥–∞–∑–∏–Ω–æ–º
  supportMessages SupportMessage[] @relation("StoreSupportMessages") // —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞
}

model Warehouse {
  id           Int    @id @default(autoincrement())
  productCount Int
  storeId      Int   @unique

  store        Store @relation(fields: [storeId], references: [id])
  products     ProductOnWarehouse[]
}

model Product {
  id          Int     @id @default(autoincrement())
  name        String
  description String
  expiration  Int
  price       Float
  photo       String?

  warehouses ProductOnWarehouse[]
}

/// –¢–∞–±–ª–∏—Ü–∞-—Å–≤—è–∑–∫–∞ "–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º" –º–µ–∂–¥—É Product –∏ Warehouse
model ProductOnWarehouse {
  id          Int       @id @default(autoincrement())
  productId   Int
  warehouseId Int

  product     Product   @relation(fields: [productId], references: [id])
  warehouse   Warehouse @relation(fields: [warehouseId], references: [id])
}

model Supplier {
  id          Int             @id @default(autoincrement())
  name        String  // üîë –∏–º—è –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
  address     String
  description String
  batchCount  Int?
  password    String // üîë –ø–∞—Ä–æ–ª—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
  photo       String?  

  batches     ProductBatch[]
  supplies    Supply[]        @relation("SupplierSupplies") // –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏
  reviews     Review[]        @relation("SupplierReviews") // –æ—Ç–∑—ã–≤—ã –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º
  supportMessages SupportMessage[] @relation("SupplierSupportMessages") // —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
}

model ProductBatch {
  id           Int     @id @default(autoincrement())
  name         String
  description  String
  expiration   Int
  price        Float
  photo        String?
  productCount Int

  supplierId   Int
  supplier     Supplier @relation(fields: [supplierId], references: [id])
}

model Supply {
  id             Int      @id @default(autoincrement())
  fromSupplierId Int
  toStoreId      Int
  content        String
  status         String

  fromSupplier   Supplier @relation("SupplierSupplies", fields: [fromSupplierId], references: [id])
  toStore        Store    @relation("StoreSupplies", fields: [toStoreId], references: [id])
}

model Review {
  id          Int      @id @default(autoincrement())
  text        String   // —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
  createdAt   DateTime @default(now()) // –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ç–∑—ã–≤–∞
  
  // –æ—Ç –∫–æ–≥–æ (–º–∞–≥–∞–∑–∏–Ω –æ—Å—Ç–∞–≤–∏–≤—à–∏–π –æ—Ç–∑—ã–≤)
  fromStoreId Int
  fromStore   Store    @relation("StoreReviews", fields: [fromStoreId], references: [id])
  
  // –∫–æ–º—É (–ø–æ—Å—Ç–∞–≤—â–∏–∫ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞–ø–∏—Å–∞–ª–∏ –æ—Ç–∑—ã–≤)
  toSupplierId Int
  toSupplier   Supplier @relation("SupplierReviews", fields: [toSupplierId], references: [id])

  @@map("reviews")
}

model SupportMessage {
  id          Int      @id @default(autoincrement())
  text        String   // —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  createdAt   DateTime @default(now()) // –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  
  // –æ—Ç –∫–æ–≥–æ (–º–∞–≥–∞–∑–∏–Ω –∏–ª–∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫)
  fromStoreId Int?     // –º–æ–∂–µ—Ç –±—ã—Ç—å null –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞
  fromSupplierId Int?  // –º–æ–∂–µ—Ç –±—ã—Ç—å null –µ—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞
  
  fromStore    Store?    @relation("StoreSupportMessages", fields: [fromStoreId], references: [id])
  fromSupplier Supplier? @relation("SupplierSupportMessages", fields: [fromSupplierId], references: [id])

  @@map("support_messages")
}

